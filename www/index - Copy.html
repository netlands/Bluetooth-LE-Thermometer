<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1,  target-densitydpi=device-dpi" />

    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <title>RFduino Temp</title>
</head>
<script>
    var myTimer;
    var timerActive = false;
    var startTemp;
</script>

<body>
    <div class="app">


        <span class="temp"><span id="tempCelsius">10</span>&deg;</span>
        <br/>
        <span id="tempFahrenheit">00</span>&nbsp;&deg;F
        <br/>


        <form>
            Target:&nbsp;
            <input type="number" id="target" name="target" />&nbsp;&deg;C
            <button id="button" type="button" onclick="timerButton();">Start</button>
            <audio id="alarm" src="alarm.mp3" preload="auto"></audio>
            <br /><span id="time"></span>
            <script>
                function timerButton() {
                    if (timerActive) {
                        stopTimer();
                        document.getElementById("button").innerHTML = "Start";
                    } else {
                        startTimer();
                        document.getElementById("button").innerHTML = "Stop"
                    }
                }

                function startTimer() {
                    timerActive = true;
                    startTemp = document.getElementById("tempCelsius").innerHTML;
                    myTimer = setInterval(timer, 1000);
                }

                function stopTimer() {
                    timerActive = false;
                    clearInterval(myTimer);
                    stopAlarmSound();
                }

                function timer() {
                    var d = new Date();
                    document.getElementById("time").innerHTML = d.toLocaleTimeString();

                    if (document.getElementById("target").value > startTemp) {
                        if (document.getElementById("tempCelsius").innerHTML >= document.getElementById("target").value) {
                            playAlarmSound();
                        }
                    } else {
                        if (document.getElementById("tempCelsius").innerHTML <= document.getElementById("target").value) {
                            playAlarmSound();
                        }
                    }

                }

                function playAlarmSound() {
                    document.getElementById('alarm').play();
                }

                function stopAlarmSound() {
                    document.getElementById('alarm').pause();
                    document.getElementById('alarm').currentTime = 0;
                }
            </script>

        </form>
    </div>
</body>

</html>